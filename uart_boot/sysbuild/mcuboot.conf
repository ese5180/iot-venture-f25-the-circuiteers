# STEP 2.3 - Enable logging for MCUboot
CONFIG_LOG=y
CONFIG_MCUBOOT_LOG_LEVEL_INF=y
CONFIG_LOG_MODE_IMMEDIATE=y

# MCUboot serial recovery configuration
CONFIG_MCUBOOT_SERIAL=y
CONFIG_BOOT_SERIAL_UART=y

# Serial recovery settings
CONFIG_BOOT_SERIAL_DETECT_DELAY=450
CONFIG_BOOT_SERIAL_NO_APPLICATION=y
CONFIG_BOOT_SERIAL_ENTRANCE_GPIO=y

# Increase buffer sizes for better mcumgr performance
CONFIG_BOOT_SERIAL_MAX_RECEIVE_SIZE=2048
CONFIG_BOOT_MAX_LINE_INPUT_LEN=2048

# LED indication
CONFIG_MCUBOOT_INDICATION_LED=y

# GPIO for button detection
CONFIG_GPIO=y

# CRITICAL: Enable image swapping mechanism
CONFIG_BOOT_SWAP_USING_SCRATCH=y

# ESSENTIAL: Disable upgrade-only mode to enable swapping
CONFIG_BOOT_UPGRADE_ONLY=n

# Disable bootstrap mode for dual slot operation
CONFIG_BOOT_BOOTSTRAP=n

# Enable image validation for both slots
CONFIG_BOOT_VALIDATE_SLOT0=y

# IMPORTANT: Disable single slot mode for dual slot operation
CONFIG_SINGLE_APPLICATION_SLOT=n

# Enable swap status tracking
CONFIG_BOOT_MAX_IMG_SECTORS=256
CONFIG_BOOT_MAX_IMG_SECTORS_AUTO=n

# Enable swap state management
CONFIG_BOOT_SWAP_SAVE_ENCTLV=n

# Ensure proper flash operations
CONFIG_FLASH=y
CONFIG_FLASH_MAP=y

# Memory optimization
CONFIG_MAIN_STACK_SIZE=10240
CONFIG_SIZE_OPTIMIZATIONS=y
CONFIG_MINIMAL_LIBC=y
CONFIG_CBPRINTF_NANO=y

# Disable console in bootloader (enable serial recovery instead)
CONFIG_UART_CONSOLE=n
CONFIG_CONSOLE=n
CONFIG_CONSOLE_HANDLER=n

# Signature configuration (using unsigned for simplicity)
CONFIG_BOOT_SIGNATURE_TYPE_NONE=y

# Multithreading
CONFIG_MULTITHREADING=y